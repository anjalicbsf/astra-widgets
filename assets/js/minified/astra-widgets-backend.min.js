!function(d){AstraWidgets={init:function(){this._init_colorpicker(),this._init_repeater(),this._bind()},_init_colorpicker:function(){d(".astra-widget-field-color input").wpColorPicker({change:function(e,t){}})},_bind:function(){d(document).on("widget-updated widget-added",AstraWidgets._reinit_controls),d(document).on("click",".astra-select-icon",AstraWidgets._icon_selector),d(document).on("click",".astra-widget-icon",AstraWidgets._set_icon),d(document).on("click",".astra-repeater-sortable .clone",AstraWidgets._repeater_clone),d(document).on("click",".astra-repeater-sortable .remove",AstraWidgets._repeater_remove),d(document).on("click",".astra-repeater-field .actions",AstraWidgets._repeater_toggle_open),d(document).on("click",".astra-repeater .add-new-btn",AstraWidgets._add_new),d(document).on("click",".widget-control-save",AstraWidgets._repeater_reinit),d(document).on("click",".astra-repeater-field .astra-select-image",AstraWidgets._repeater_add_image_field),d(document).on("click",".astra-repeater-field .astra-remove-image",AstraWidgets._repeater_remove_image_field),d(document).on("input",'.astra-repeater-field [data-field-id="title"]',AstraWidgets._repeater_set_title)},_reinit_controls:function(){AstraWidgets._init_colorpicker(),AstraWidgets._init_repeater()},_icon_selector:function(e){d(this).parents(".astra-widget-icon-selector").find(".astra-icons-list-wrap").slideToggle()},_set_icon:function(e){var t=d(this).parents(".astra-widget-icon-selector"),a=d(this).attr("data-font")||"",i=t.find(".astra-selected-icon i"),r=t.find(".selected-icon");i.removeClass(),i.addClass(a),"yes"===d(this).closest(".astra-repeater-field").find(".selected-icon").data("icon-visible")&&(d(this).closest(".astra-repeater-field").find(".title").attr("class","title"),d(this).closest(".astra-repeater-field").find(".title").addClass(a)),r.val(a),t.find(".selected-icon").trigger("change")},_repeater_remove_image_field:function(e){if(confirm("Do you want to remove this image?")){var t=d(this).parents(".astra-repeater-field");t.find(".astra-field-image-preview").html(""),t.find(".astra-field-image-preview img").attr("src",""),t.find(".astra-field-image-preview-id").val(""),t.find(".astra-image-url").val(""),t.find(".astra-image-alt").val(""),t.find(".astra-image-title").val(""),t.find(".astra-image-size-select, .astra-image-width").hide()}},_repeater_add_image_field:function(e){var a=d(this).parents(".astra-repeater-field"),i=wp.media({title:"Select or Upload Image",button:{text:"Choose Image"},library:{type:"image"},multiple:!1});return i.on("close",function(){var e=i.state().get("selection").toJSON();if(!d.isEmptyObject(e)){if(e[0].sizes.hasOwnProperty("medium"))var t=e[0].sizes.medium.url;else if(e[0].sizes.hasOwnProperty("thumbnail"))t=e[0].sizes.thumbnail.url;else t=e[0].sizes.full.url;0<a.find(".astra-remove-image").length?a.find(".astra-field-image-preview img").attr("src",t):a.find(".astra-field-image-preview").append('<span class="astra-remove-image button">Remove</span><img src="'+t+'" />'),a.find(".astra-image-url").val(e[0].url),a.find(".astra-image-alt").val(e[0].alt),a.find(".astra-image-title").val(e[0].title),a.find(".astra-field-image-preview-id").val(e[0].id),a.find(".astra-image-size-select, .astra-image-width").show(),a.find("input").trigger("change")}}),i.open(),!1},_get_sub_string:function(e){var t="";if(24<e.length)t="..";return e=e.substring(0,24)+t},_repeater_set_title:function(e){var t=d(this).val()||"";t=AstraWidgets._get_sub_string(t),d(this).closest(".astra-repeater-field").find(".title").text(t)},_repeater_reinit:function(e){d(".astra-repeater-sortable").sortable()},_add_new:function(e){e.preventDefault();var t=d(this).closest(".astra-repeater"),a=d(".astra-repeater-field").length||0,i=t.find(".astra-repeater-fields").html(),r=t.find(".astra-repeater-fields").attr("title")||"",s=(t.find(".astra-repeater-fields").attr("data-id"),'<div class="astra-repeater-field">');s+='\t<div class="actions">',s+='\t<span class="index">'+a+"</span>",s+='\t\t<span class="dashicons dashicons-move"></span>',s+='\t<span class="title">'+r+"</span>",s+='\t\t<span class="dashicons dashicons-admin-page clone"></span>',s+='\t\t<span class="dashicons dashicons-trash remove"></span>',s+="\t</div>",s+='\t<div class="markukp">',s+=i=i.replace("][][","]["+a+"]["),s+="\t</div>",s+="</div>",t.find(".astra-repeater-sortable").append(s),AstraWidgets._set_repeater_names()},_set_repeater_names:function(){d(".astra-repeater").each(function(e,t){var n=d(t).find(".astra-repeater-fields").attr("data-id")||"";d(t).find(".astra-repeater-sortable").find(".astra-repeater-field").each(function(r,s){d(s).find(":input").each(function(e,t){var a=d(t).attr("data-field-id")||"",i=n+"["+r+"]["+a+"]";d(s).find(".index").text(r),d(t).attr("name",i)})})})},_repeater_toggle_open:function(e){e.preventDefault(),(e.target===this||d(e.target).hasClass("title")||d(e.target).hasClass("dashicons-move"))&&d(this).parents(".astra-repeater-field").find(".markukp").slideToggle()},_repeater_clone:function(e){e.preventDefault();var t=d(this),a=t.closest(".astra-repeater");a.find(".astra-repeater-fields").html();d(t).closest(".astra-repeater-field").clone().insertAfter(t.closest(".astra-repeater-field")),d(".astra-repeater-sortable").sortable(),a.find("input").trigger("change"),AstraWidgets._set_repeater_names()},_repeater_remove:function(e){e.preventDefault();var t=d(this),a=t.closest(".astra-repeater"),i=t.parent().find(".title").html(),r="";r=0<i.length?i:"this field",confirm("Are you sure you want to delete "+r+"?")&&t.closest(".astra-repeater-field").remove(),AstraWidgets._set_repeater_names(),a.find("input").trigger("change")},_init_repeater:function(){d(".astra-repeater-sortable").sortable({cursor:"move",stop:function(e,t){AstraWidgets._set_repeater_names(),t.item.find("input").trigger("change")}}),AstraWidgets._set_repeater_names(),d(".astra-repeater-field").length&&d(".astra-repeater-field").each(function(e,t){var a=d(t).find('[data-field-id="title"]').val()||"",i=d(t).find('[data-field-id="icon"]').val()||"";a=AstraWidgets._get_sub_string(a),d(t).find(".title").text(a),"yes"===d(t).find(".selected-icon").data("icon-visible")&&d(t).find(".title").addClass(i)})}},d(function(){AstraWidgets.init()})}(jQuery);